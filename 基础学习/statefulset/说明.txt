headless service 需要将 spec.clusterIP 设置成 None。

因为没有ClusterIP，kube-proxy 并不处理此类服务，因为没有load balancing或 proxy 代理设置，在访问服务的时候回返回后端的全部的Pods IP地址，主要用于开发者自己根据pods进行负载均衡器的开发(设置了selector)。

kubectl create -f ./deployment.yaml
kubectl create -f ./headless_service.yaml
以后

启动测试容器
kubectl exec -it busybox -- /bin/sh

nslookup nginx-service
可以看到两个ip

模拟失败
kubectl delete sts xxx --cascade=false
后面的参数的意思是，不级联删除相关pod，手动删除
kubectl delete pod nginx-sts-0